"""
2015 개정 교육과정 수학 과목 정의
수학1, 수학2, 미적분 세부 내용
"""

# 2015 개정 교육과정 수학 과목 구조
CURRICULUM_2015 = {
    "수학1": {
        "chapters": {
            "지수함수와 로그함수": {
                "sections": [
                    "지수",
                    "로그", 
                    "지수함수",
                    "로그함수"
                ],
                "core_concepts": [
                    "지수법칙", "거듭제곱근", "로그의 정의와 성질",
                    "지수함수 y=a^x", "로그함수 y=log_a(x)",
                    "지수방정식과 부등식", "로그방정식과 부등식"
                ],
                "curriculum_limits": [
                    "복소수 범위의 지수는 다루지 않음",
                    "자연로그 e의 정의는 극한 없이 다룸",
                    "로그미분법은 수학1에서 다루지 않음",
                    "e^x, ln(x) 같은 초월함수의 미적분은 미적분 과목에서만 다룸"
                ]
            },
            "삼각함수": {
                "sections": [
                    "삼각함수",
                    "삼각함수의 그래프",
                    "삼각함수의 활용"
                ],
                "core_concepts": [
                    "호도법", "삼각함수의 정의",
                    "sin, cos, tan의 그래프와 성질",
                    "삼각함수의 주기, 진폭, 위상",
                    "사인법칙과 코사인법칙"
                ],
                "curriculum_limits": [
                    "역삼각함수는 다루지 않음",
                    "삼각함수의 덧셈정리는 기본만 다룸",
                    "극좌표는 교육과정 외"
                ]
            },
            "수열": {
                "sections": [
                    "등차수열과 등비수열",
                    "수열의 합",
                    "수학적 귀납법"
                ],
                "core_concepts": [
                    "등차수열과 등비수열의 일반항",
                    "Σ(시그마) 기호와 수열의 합",
                    "자연수의 거듭제곱 합 공식",
                    "수학적 귀납법"
                ],
                "curriculum_limits": [
                    "수열의 극한은 미적분에서 다룸",
                    "점화식은 간단한 형태만 다룸",
                    "생성함수는 교육과정 외"
                ]
            }
        }
    },
    
    "수학2": {
        "chapters": {
            "함수의 극한과 연속": {
                "sections": [
                    "함수의 극한",
                    "함수의 연속"
                ],
                "core_concepts": [
                    "함수의 극한 정의",
                    "극한의 성질과 계산",
                    "함수의 연속성",
                    "연속함수의 성질"
                ],
                "curriculum_limits": [
                    "엡실론-델타 정의는 직접 다루지 않음",
                    "일양연속은 교육과정 외",
                    "무한대에서의 극한은 기본만"
                ]
            },
            "미분": {
                "sections": [
                    "미분계수와 도함수",
                    "도함수의 활용"
                ],
                "core_concepts": [
                    "미분계수의 정의",
                    "도함수와 미분법",
                    "접선의 방정식",
                    "함수의 증가·감소와 극값",
                    "최대·최소 문제"
                ],
                "curriculum_limits": [
                    "음함수 미분은 수학2에서 다루지 않음",
                    "매개변수 미분은 미적분에서",
                    "테일러 급수는 교육과정 외"
                ]
            },
            "적분": {
                "sections": [
                    "부정적분",
                    "정적분",
                    "정적분의 활용"
                ],
                "core_concepts": [
                    "부정적분과 원시함수",
                    "정적분의 정의",
                    "미적분의 기본정리",
                    "넓이와 부피 계산"
                ],
                "curriculum_limits": [
                    "치환적분과 부분적분은 미적분에서",
                    "이상적분은 교육과정 외",
                    "다중적분은 다루지 않음"
                ]
            }
        }
    },
    
    "미적분": {
        "chapters": {
            "수열의 극한": {
                "sections": [
                    "수열의 극한",
                    "급수"
                ],
                "core_concepts": [
                    "수열의 수렴과 발산",
                    "등비수열의 극한",
                    "무한급수와 부분합",
                    "등비급수"
                ],
                "curriculum_limits": [
                    "테일러 급수는 언급 정도",
                    "푸리에 급수는 교육과정 외",
                    "함수급수는 다루지 않음"
                ]
            },
            "미분법": {
                "sections": [
                    "여러 가지 함수의 미분",
                    "도함수의 활용"
                ],
                "core_concepts": [
                    "삼각함수의 도함수",
                    "지수·로그함수의 도함수 (e^x, ln(x) 포함)",
                    "음함수와 역함수의 미분",
                    "매개변수로 나타낸 함수의 미분",
                    "초월함수 (e^x, ln(x))의 미분"
                ],
                "curriculum_limits": [
                    "벡터함수의 미분은 교육과정 외",
                    "편미분은 다루지 않음",
                    "미분방정식은 간단한 것만",
                    "초월함수는 미적분 과목에서만 다룸"
                ]
            },
            "적분법": {
                "sections": [
                    "여러 가지 적분법",
                    "정적분의 활용"
                ],
                "core_concepts": [
                    "치환적분법",
                    "부분적분법",
                    "유리함수와 무리함수의 적분",
                    "회전체의 부피"
                ],
                "curriculum_limits": [
                    "복소적분은 교육과정 외",
                    "선적분, 면적분은 다루지 않음",
                    "르베스그 적분은 교육과정 외"
                ]
            }
        }
    }
}

# 교육과정 준수 체크리스트
CURRICULUM_COMPLIANCE = {
    "필수_준수_사항": [
        "모든 문제는 2015 개정 교육과정 범위 내에서 출제",
        "고난도 문제도 교육과정 내 개념의 심화 응용으로 구성",
        "교육과정 외 개념은 절대 요구하지 않음",
        "각 과목별 학습 순서와 위계 준수"
    ],
    
    "금지_사항": [
        "대학 과정 개념 직접 사용 금지",
        "교육과정에 명시되지 않은 공식 사용 금지",
        "과목 간 선수학습 관계 위반 금지"
    ],
    
    "고난도_문제_원칙": [
        "교육과정 내 여러 개념의 융합",
        "복잡한 계산보다는 사고력 중심",
        "단계적 접근이 필요한 문제",
        "실생활 맥락의 응용 문제"
    ],
    
    "킬러_문제_원칙": [
        "2015 개정 교육과정 범위 내에서 최고 난도",
        "수학1+수학2 또는 미적분 개념 융합 필수",
        "항등식, 명제 등 고급 사고력 요구",
        "직관적 접근이 어려운 문제 설계"
    ]
}

# 울트라 하드 문항 생성 가이드라인 (2015 개정 교육과정 준수)
ULTRA_HARD_PROBLEM_GUIDELINES = {
    "필수_요소": [
        "항등식의 복잡한 해석",
        "여러 단원의 개념 융합 (수학1, 수학2, 수학1+수학2, 또는 미적분)",
        "어려운 명제의 참/거짓 판별",
        "다단계 사고 과정 요구",
        "경우의 수 분할 또는 조건 분석"
    ],
    
    "울트라하드_패턴": {
        "수학1_단독": [
            "복잡한 지수/로그 방정식과 부등식",
            "삼각함수의 고급 항등식과 변환",
            "수열의 점화식과 수학적 귀납법"
        ],
        "수학2_단독": [
            "함수의 극한과 연속성의 복잡한 판별",
            "미분가능성과 극값의 고급 문제",
            "정적분의 복잡한 응용"
        ],
        "수학1_수학2_융합": [
            "지수/로그 함수와 미분의 결합 (e^x, ln(x) 제외)",
            "삼각함수와 극한/연속의 결합",
            "수열과 함수 극한의 관계"
        ],
        "미적분_울트라하드": [
            "초월함수 (e^x, ln(x))의 미적분",
            "매개변수 미분법의 고급 응용",
            "음함수 미분법의 복잡한 문제",
            "역함수 미분법과 적분",
            "복잡한 함수의 최댓값/최솟값",
            "여러 조건을 만족하는 함수 찾기",
            "적분과 미분의 복합 적용",
            "급수의 수렴성과 함수의 성질"
        ],
        "항등식_활용": [
            "f(g(x)) = g(f(x)) 형태의 함수 찾기",
            "여러 변수의 항등식 관계",
            "점화식과 항등식의 결합"
        ]
    },
    
    "금지_사항": [
        "대학 과정 개념 사용 금지",
        "2015 개정 교육과정 범위 초과 금지",
        "지나치게 복잡한 계산보다는 사고력 중심",
        "문제 자체가 모호하거나 이해 불가능한 경우 배제",
        "초월함수 (e^x, ln(x))는 미적분 과목이 아닌 경우 사용 금지"
    ],
    
    "난이도_배점": {
        "울트라하드_선택형": 4,  # 14번, 15번 위치
        "울트라하드_단답형": 4   # 21번, 22번, 29번, 30번 위치
    }
}

# 문제 유형별 출제 가이드라인
PROBLEM_GUIDELINES = {
    "수학1": {
        "지수_로그": {
            "기본": "지수법칙, 로그 성질 직접 적용",
            "중급": "지수·로그 방정식과 부등식",
            "심화": "실생활 응용 (인구증가, 반감기 등)",
            "금지": "복소수 범위, 로그미분법"
        },
        "삼각함수": {
            "기본": "삼각함수 값 계산, 그래프 해석",
            "중급": "사인·코사인 법칙 활용",
            "심화": "주기 현상 모델링",
            "금지": "역삼각함수, 쌍곡함수"
        },
        "수열": {
            "기본": "등차·등비수열 일반항",
            "중급": "Σ 계산, 수학적 귀납법",
            "심화": "점화식 활용 (간단한 형태)",
            "금지": "수열의 극한, 생성함수"
        }
    },
    
    "수학2": {
        "극한_연속": {
            "기본": "극한값 계산, 연속성 판별",
            "중급": "극한 성질 활용, 중간값 정리",
            "심화": "함수 조작을 통한 극한",
            "금지": "ε-δ 논법, 일양연속"
        },
        "미분": {
            "기본": "도함수 계산, 접선 방정식",
            "중급": "극값 판정, 그래프 개형",
            "심화": "최적화 문제, 변화율 응용",
            "금지": "테일러 급수, 편미분"
        },
        "적분": {
            "기본": "부정적분, 정적분 계산",
            "중급": "넓이 계산, 기본정리 활용",
            "심화": "부피 계산, 물리량 계산",
            "금지": "이상적분, 다중적분"
        }
    },
    
    "미적분": {
        "수열_극한": {
            "기본": "수열 극한 계산",
            "중급": "급수의 수렴 판정",
            "심화": "급수와 함수의 연결",
            "금지": "함수급수, 균등수렴"
        },
        "미분법": {
            "기본": "삼각·지수·로그 함수 미분",
            "중급": "음함수·매개변수 미분",
            "심화": "복합 함수의 최적화",
            "금지": "벡터 미분, 변분법"
        },
        "적분법": {
            "기본": "치환·부분적분",
            "중급": "유리함수 적분",
            "심화": "회전체 부피, 곡선 길이",
            "금지": "복소적분, 측도론"
        }
    }
}

def validate_problem_curriculum(subject: str, topic: str, concepts: list) -> dict:
    """
    문제가 교육과정을 준수하는지 검증
    
    Args:
        subject: 과목명
        topic: 주제
        concepts: 사용된 개념 리스트
        
    Returns:
        검증 결과 딕셔너리
    """
    result = {
        "valid": True,
        "warnings": [],
        "errors": []
    }
    
    if subject not in CURRICULUM_2015:
        result["valid"] = False
        result["errors"].append(f"과목 '{subject}'는 2015 개정 교육과정에 없습니다")
        return result
    
    curriculum = CURRICULUM_2015[subject]["chapters"]
    
    # 주제 확인
    valid_topic = False
    for chapter in curriculum.values():
        if topic in chapter.get("sections", []) or topic in curriculum.keys():
            valid_topic = True
            break
    
    if not valid_topic:
        result["warnings"].append(f"주제 '{topic}'가 {subject}의 표준 주제가 아닙니다")
    
    # 개념 확인
    for concept in concepts:
        # 금지된 개념 체크
        for chapter in curriculum.values():
            if "curriculum_limits" in chapter:
                for limit in chapter["curriculum_limits"]:
                    if concept.lower() in limit.lower():
                        result["valid"] = False
                        result["errors"].append(f"개념 '{concept}'는 교육과정 범위를 벗어납니다: {limit}")
    
    return result

def get_curriculum_info(subject: str) -> dict:
    """
    과목별 교육과정 정보 반환
    
    Args:
        subject: 과목명
        
    Returns:
        교육과정 정보 딕셔너리
    """
    if subject not in CURRICULUM_2015:
        return {}
    
    info = {
        "subject": subject,
        "chapters": list(CURRICULUM_2015[subject]["chapters"].keys()),
        "total_sections": 0,
        "core_concepts": [],
        "limitations": []
    }
    
    for chapter_name, chapter_data in CURRICULUM_2015[subject]["chapters"].items():
        info["total_sections"] += len(chapter_data.get("sections", []))
        info["core_concepts"].extend(chapter_data.get("core_concepts", []))
        info["limitations"].extend(chapter_data.get("curriculum_limits", []))
    
    return info