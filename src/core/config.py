import os
from dotenv import load_dotenv

load_dotenv()

GEMINI_API_KEY = os.getenv('GEMINI_API_KEY')

if not GEMINI_API_KEY:
    raise ValueError("GEMINI_API_KEY가 설정되지 않았습니다. .env 파일을 확인해주세요.")

# 2015 개정 교육과정 - 가형/나형 구분 없음
PROBLEM_TYPES = {
    "선택형": {
        "문항수": 21,
        "배점": [2, 3, 4],
        "난이도": ["하", "중", "상", "킬러"],
        "choices_count": 5  # 선택지 개수
    },
    "단답형": {
        "문항수": 9,
        "배점": [3, 4],
        "난이도": ["중", "상", "킬러"]
    }
}

# 2015 개정 교육과정 기준 과목별 단원 구성 (수학1, 수학2, 미적분만 포함)
CURRICULUM_2015 = {
    "수학1": {
        "지수함수와 로그함수": [
            "지수함수의 그래프와 성질",
            "로그함수의 그래프와 성질", 
            "지수방정식과 지수부등식",
            "로그방정식과 로그부등식"
            # 주의: e^x, ln x는 미적분에서만 다룸
        ],
        "삼각함수": [
            "삼각함수의 그래프와 성질",
            "삼각함수의 활용",
            "사인법칙과 코사인법칙",
            "삼각방정식과 삼각부등식"
        ],
        "수열": [
            "등차수열과 등비수열",
            "수열의 합",
            "수학적 귀납법",
            "수열의 일반항"
        ]
    },
    "수학2": {
        "함수의 극한과 연속": [
            "함수의 극한",
            "함수의 연속",
            "연속함수의 성질"
        ],
        "미분": [
            "도함수",
            "도함수의 활용",
            "함수의 증가와 감소",
            "함수의 극대와 극소",
            "함수의 그래프"
        ],
        "적분": [
            "부정적분",
            "정적분",
            "정적분의 활용",
            "넓이와 부피"
        ]
    },
    "미적분": {
        "수열의 극한": [
            "수열의 극한",
            "급수",
            "등비급수",
            "멱급수"
        ],
        "미분법": [
            "지수함수와 로그함수의 미분",  # e^x, ln x는 여기서만
            "삼각함수의 미분",
            "음함수의 미분",
            "매개변수로 나타낸 함수의 미분",
            "몫의 미분법",
            "연쇄법칙"
        ],
        "적분법": [
            "여러 가지 적분법",
            "부분적분",
            "치환적분",
            "이상적분",
            "정적분의 활용"
        ],
        "적분의 활용": [
            "리만 합",
            "정적분과 넓이",
            "정적분과 부피",
            "곡선의 길이"
        ]
    }
}

# 2015 개정 교육과정에서는 가형/나형이 없음 - 공통+선택 구조
# 우리는 수학1, 수학2, 미적분만 다룸
AVAILABLE_SUBJECTS = ["수학1", "수학2", "미적분"]

# 과목별 주제 목록 생성 (UI 표시용)
def get_all_topics() -> list:
    """모든 과목의 주제 목록 반환"""
    topics = []
    
    for subject in AVAILABLE_SUBJECTS:
        if subject in CURRICULUM_2015:
            for chapter in CURRICULUM_2015[subject].keys():
                # 과목명과 단원명을 함께 표시
                topics.append(f"[{subject}] {chapter}")
    
    return topics

# MATH_TOPICS를 단순화 (가형/나형 구분 제거)
MATH_TOPICS = get_all_topics()

# 난이도별 문제 착안 포인트
DIFFICULTY_GUIDELINES = {
    "하": {
        "description": "기본 개념 및 단순 계산",
        "steps": "1-2단계",
        "time_estimate": "1-2분"
    },
    "중": {
        "description": "개념 응용 및 복합 사고",
        "steps": "3-4단계",
        "time_estimate": "3-5분"
    },
    "상": {
        "description": "심화 사고 및 창의적 문제해결",
        "steps": "5단계 이상",
        "time_estimate": "5-10분",
        "special_features": [
            "여러 개념의 통합",
            "역사고력 필요",
            "조건 변화 분석",
            "최적화 문제",
            "존재성 증명"
        ]
    },
    "킬러": {
        "description": "초고난도 킬러 문항 (명시적 선택 필요)",
        "steps": "7단계 이상",
        "time_estimate": "15-25분",
        "special_features": [
            "항등식 숨겨진 활용",
            "3개 이상 단원 융합",
            "부등식 조건 복잡화",
            "역사고력과 창의성 필수",
            "표준 해법 불가능",
            "깊은 통찰 필요"
        ]
    }
}

# 특별 주제별 문제 유형 상세 정의
SPECIALIZED_PROBLEM_TYPES = {
    "[미적분] 미분법": {  # e^x, ln x는 미적분에서만
        "e^x 활용 문제": [
            "자연지수함수 e^x의 미분",
            "e^x = a 형태의 지수방정식",
            "복합함수 f(e^x)의 미분",
            "e^x를 포함한 극한값 계산",
            "자연지수함수의 그래프와 성질",
            "e^x와 다른 함수의 교점",
            "e^x를 포함한 적분 계산"
        ],
        "ln x 활용 문제": [
            "자연로그함수 ln x의 미분",
            "ln x = a 형태의 로그방정식", 
            "복합함수 f(ln x)의 미분",
            "ln x를 포함한 극한값 (로피탈 정리)",
            "자연로그함수의 그래프와 성질",
            "ln x와 다른 함수의 교점",
            "ln x를 포함한 적분 계산"
        ],
        "지수로그 미분 복합문제": [
            "e^x와 ln x를 포함한 복합함수의 미분",
            "지수로그 함수의 최댓값/최솟값",
            "음함수 미분과 지수로그",
            "매개변수 미분과 지수로그"
        ]
    },
    
    "[수학1] 삼각함수": {  # 사인법칙, 코사인법칙
        "사인 법칙 활용": [
            "삼각형의 변의 길이 구하기",
            "삼각형의 각의 크기 구하기", 
            "외접원의 반지름 구하기",
            "삼각형의 넓이 (사인 법칙 이용)",
            "높이를 이용한 거리 측정",
            "사각형을 두 삼각형으로 분할",
            "부등삼각형의 존재 조건"
        ],
        "코사인 법칙 활용": [
            "삼각형의 변의 길이 구하기",
            "삼각형의 각의 크기 구하기",
            "삼각형의 넓이 (코사인 법칙 이용)",
            "사각형의 대각선 길이",
            "입체도형에서의 거리 계산",
            "벡터와 코사인 법칙의 결합",
            "최단거리 문제"
        ],
        "복합 도형문제": [
            "사인법칙과 코사인법칙 동시 사용",
            "삼각형과 원의 복합문제",
            "입체도형에서의 각도와 거리",
            "삼각측량을 이용한 실생활 문제",
            "정사영을 이용한 넓이 계산",
            "구의 표면에서의 거리",
            "공간좌표에서의 삼각법칙"
        ]
    }
}